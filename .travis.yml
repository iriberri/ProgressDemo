language: objective-c
osx_image: xcode9.3
branches:
  only:
  - master
env:
  global:
  - APP_NAME="ProgressDemo"
  - 'DEVELOPER_NAME="iPhone Distribution: 24/7 Software, Inc. (EFF562SLKT)"'
  - PROFILE_NAME="TravisExample_Ad_Hoc"
  - PROVISIONING_PROFILE="$HOME/Library/MobileDevice/Provisioning Profiles/$PROFILE_NAME.mobileprovision"
  - OUTPUTDIR="$PWD/build/Release-iphoneos"
before_script:
- mkdir build
- mkdir build/Release-iphoneos
- echo "aaaaaaaa" > build/Release-iphoneos/ProgressDemo.ipa
before_install:
- true
script:
  - true
after_success:
- "./scripts/sign-and-upload.sh"
after_script:
- "./scripts/remove-key.sh"

before_deploy:
- ls ./build/Release-iphoneos/*.ipa
- ls /Users/travis/build/iriberri/ProgressDemo/build/Release-iphoneos/*.ipa

deploy:
  provider: releases
  api_key: $GITHUB_TOKEN
  file: ./build/Release-iphoneos/ProgressDemo.ipa
  skip_cleanup: true
  on:
    repo: iriberri/ProgressDemo
